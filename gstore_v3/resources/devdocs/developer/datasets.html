<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html>
<head>
    <title>Virtual Watershed API | Developer - Datasets</title>
    <link href="../bootstrap/css/bootstrap.min.css" rel="stylesheet" media="screen">
    <link href="../docs.css" rel="stylesheet" media="screen">

</head>
<body>
<div id="wrap">
    <div class="navbar navbar-inverse" role="navigation">
        <div class="container">
            <div class="navbar-header">
                <a class="navbar-brand" href="../index.html">Virtual Watershed</a>
            </div>
            <div class="collapse navbar-collapse">
                <ul class="nav navbar-nav">
                    <li><a href="../../docs/stable.html">Stable</a></li>
                    <li class="active"><a href="#">Developer</a></li>
                    <li><a href="../../docs/architecture.html">Architecture</a></li>
                </ul>
            </div>
        </div>
    </div>

    <div class="container docs">
        <div class="row">
            <h1>Datasets</h1>

            <p></p>
        </div>

        <div class="row">
            <div class="col-lg-12 col-no-padding">
                <ul>
                    <li id="preview">
                        <div class="http-definition">
                            <h3>
                                <span class="http-method">GET</span>
                                <span class="http-path">/apps/{app}/datasets/{uuid}/mapper</span>
                                <span class="http-name">Get dataset previewer</span>
                            </h3>
                        </div>

                        <div class="http-options">
                            <p>Basic data preview HTML.</p>
                            <p class="bg-callouts bg-danger">Note: this functionality will be deprecated soon. Please take advantage of the OGC Services and other streaming data services in any future development.</p>

                            

                            <h4>Request Parameters</h4>
                            <h5>Route Parameters</h5>
                            <table class="params">
                                <thead>
                                    <tr>
                                        <th>Parameter</th>
                                        <th>Description</th>
                                        <th>Type</th>
                                        <th>Options</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr>
                                        <td>app</td>
                                        <td>Application alias</td>
                                        <td>string</td>
                                        <td>rgis, epscor, elseweb</td>
                                    </tr>
                                    <tr>
                                        <td>uuid</td>
                                        <td>Dataset identifier</td>
                                        <td>uuid</td>
                                        <td></td>
                                    </tr>
                                </tbody>
                            </table>

                            <h5>Query Parameters</h5>
                            <p>None</p>

                            <h5>Examples</h5>
                            <p>View the HTML response for the <strong>2013 Jaroso Post Fire Imagery, 32</strong> raster dataset:</p>
                            <p class="example">/apps/<span class="route-highlight">rgis</span>/datasets/<span class="route-highlight">43db7a5d-67ec-4635-aef6-97131bf390cb</span>/mapper</p>

                            <h4>Response</h4>
                            <p>The request returns an HTML page containing a basic map preview and dataset information.</p>
                        </div>
                    </li>

                    <li id="attributes">
                        <div class="http-definition">
                            <h3>
                                <span class="http-method">GET</span>
                                <span class="http-path">/apps/{app}/datasets/{uuid}/attributes.{ext}</span>
                                <span class="http-name">Get dataset attributes</span>
                            </h3>
                        </div>

                        <div class="http-options">
                            <p>Get the attribute definitions for a vector or tabular dataset.</p>
                            

                            <h4>Request Parameters</h4>
                            <h5>Route Parameters</h5>
                            <table class="params">
                                <thead>
                                    <tr>
                                        <th>Parameter</th>
                                        <th>Description</th>
                                        <th>Type</th>
                                        <th>Options</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr>
                                        <td>app</td>
                                        <td>Application alias</td>
                                        <td>string</td>
                                        <td>rgis, epscor, elseweb</td>
                                    </tr>
                                    <tr>
                                        <td>uuid</td>
                                        <td>Dataset identifier</td>
                                        <td>uuid</td>
                                        <td></td>
                                    </tr>
                                    <tr>
                                        <td>ext</td>
                                        <td>format</td>
                                        <td>string</td>
                                        <td>json, kml</td>
                                    </tr>
                                </tbody>
                            </table>

                            <h5>Query Parameters</h5>
                            <p>None</p>

                            <h5>Examples</h5>
                            <p>View the JSON response for the <strong>SNOTEL Chamita, NM (Mar, 2014)</strong> vector dataset:</p>
                            <p class="example">/apps/<span class="route-highlight">rgis</span>/datasets/<span class="route-highlight">2730123d-070c-45ee-8d8d-b5e4df135faf</span>/attributes.<span class="route-highlight">json</span></p>

                            <h4>Response</h4>
                            <div>
                                <h5>JSON Schema</h5>
                                <div class="schema-block">
                                    <div><span class="schema-object">total</span> (<span class="schema-datatype">integer</span>): number of attributes</div>
                                    <div><span class="schema-object">results</span> (<span class="schema-datatype">array(dict)</span>): 
                                        <div class="schema-nested-object">
                                            <div><span class="schema-object">datatype</span> (<span class="schema-datatype">string</span>): attribute type</div>
                                            <div><span class="schema-object">description</span> (<span class="schema-datatype">string</span>): description of the attribute, if provided</div>
                                            <div><span class="schema-object">original_name</span> (<span class="schema-datatype">string</span>): name of the attribute from the original source file (may be modified depending on the limitations of supported file types; see "name")</div>
                                            <div><span class="schema-object">uuid</span> (<span class="schema-datatype">uuid</span>): attribute identifier</div>
                                            <div><span class="schema-object">name</span> (<span class="schema-datatype">string</span>): attribute name (shapefile-safe)</div>
                                        </div>
                                    </div>
                                </div>
                                <pre>
{
    "total": 19,
    "results": [
        {
            "datatype": "int",
            "description": "NRCS Internal Site Number",
            "original_name": "Site Id",
            "uuid": "aeb97c0a-3c43-4abb-8837-c8f7e1a6f3a8",
            "name": "site_id"
        },
        {
            "datatype": "string",
            "description": "Date",
            "original_name": "Date",
            "uuid": "c9746566-2942-4357-9b34-a1891eb7eff3",
            "name": "date"
        },
        {
            "datatype": "double",
            "description": "Snow Water Equivalent",
            "original_name": "WTEQ.I-1 (in)",
            "uuid": "e5a53571-b025-4781-b42e-68a391ac6d4e",
            "name": "wteqi_1"
        }
    ]
}    
                                </pre>
                            </div>

                            <div>
                                <h5>KML Schema</h5>
                                <p>Refer to the <a href="https://developers.google.com/kml/documentation/kmlreference#schema">KML Documentation</a> for more information.</p>
                                <pre>
&lt;Schema name=&quot;2730123d-070c-45ee-8d8d-b5e4df135faf&quot; id=&quot;2730123d-070c-45ee-8d8d-b5e4df135faf&quot;&gt;
    &lt;SimpleField type=&quot;int&quot; name=&quot;site_id&quot;&gt;
        &lt;displayName&gt;site_id&lt;/displayName&gt;
    &lt;/SimpleField&gt;
    &lt;SimpleField type=&quot;string&quot; name=&quot;date&quot;&gt;
        &lt;displayName&gt;date&lt;/displayName&gt;
    &lt;/SimpleField&gt;
    &lt;SimpleField type=&quot;string&quot; name=&quot;time&quot;&gt;
        &lt;displayName&gt;time&lt;/displayName&gt;
    &lt;/SimpleField&gt;
    &lt;SimpleField type=&quot;double&quot; name=&quot;wteqi_1&quot;&gt;
        &lt;displayName&gt;wteqi_1&lt;/displayName&gt;
    &lt;/SimpleField&gt;
&lt;/Schema&gt;
                                </pre>
                            </div>
                        </div>
                    </li>
                      <li id="upload">
                        <div class="http-definition">
                            <h3>
                                <span class="http-method">POST</span>
                                <span class="http-path">/apps/{app}/data</span>
                                <span class="http-name">Upload data to the server</span>
                            </h3>
                        </div>

                        <div class="http-options">
                            <p>Allows uploading of model data to the Virual Watershed filesystem.</p>
                            

                            <h4>Request Parameters</h4>
                            <h5>Route Parameters</h5>
                            <p>{app}</p>
                            <h5>Query Parameters</h5>
                            <p>modelid: Model Run UUID</p>
                            <h5>Code Example:</h5>
                            <pre>#!/usr/bin/python
import json
import requests

#Name of server and app we are posting to:
hostname = "vwp-dev.unm.edu"
app = "vwp"

#Login info:
u = "username"
p = "password"

#File to upload:
pathtofile='/vwpdata/e535106_nw_nw.xls'
#for requests. Tells requests to open file in readonly binary mode.
files = {'file': open(pathtofile, 'rb')}

#Create URLs using hostname and app variables.
login_url = "https://" + hostname + "/apilogin"
upload_url = "https://"+hostname+"/apps/"+app+"/data"

#The model ID this file belongs to. Files are orginized by model run UUID on the filesystem.
modelid="30a426a4-b69d-494d-a851-a5a083e68d11"
payload = {"modelid": modelid}


#start the session
with requests.session() as s:
    #login within session
    l= s.get(login_url, auth=(u,p), verify=False)
    #if login is successful...
    if l.status_code == 200:
        #then post the file.
        result = s.post(upload_url, files=files, data=payload, auth=(u, p))
        if result.status_code == 200:
            print result.text
        else:
            print "FAILED UPLOAD! The error is: " + result.text
    else:
        print "Login failure. The error is: "+ l.text
</pre>
                            <h4>Response</h4>
                            <p>OK or error</p>
                        </div>
                    </li>
                      <li id="newmodelrun">
                        <div class="http-definition">
                            <h3>
                                <span class="http-method">POST</span>
                                <span class="http-path"> /apps/{app}/newmodelrun</span>
                                <span class="http-name">Create a new model run (model_run_uuid)</span>
                            </h3>
                        </div>

                        <div class="http-options">
                            <p>Creates a database record of the new model run and a landing point for files to be uploaded.</p>
                            

                            <h4>Request Parameters</h4>
                            <p>None.</p>
                            <h5>Route Parameters</h5>
                            <p>{app}</p>
                            <h5>JSON Payload Parameters</h5>
         <table class="params">
              <thead>
                  <tr>
                      <th>Parameter</th>
                      <th>Description</th>
                      <th>Type</th>
                      <th>Required</th>
                  </tr>
              </thead>
              <tbody>
                  <tr>
                      <td>description</td>
                      <td>Describes the model run.</td>
                      <td>String</td>
                      <td>F</td>
                  </tr>
              </tbody>
              <tbody>
                  <tr>
                      <td>model_run_name</td>
                      <td>Unique name of model run</td>
                      <td>String</td>
                      <td>T</td>
                  </tr>
              </tbody>
              <tbody>
                  <tr>
                      <td>model_keywords</td>
                      <td>Used for model run searches</td>
                      <td>String</td>
                      <td>F</td>
                  </tr>
              </tbody>
              <tbody>
                  <tr>
                      <td>externaluserid</td>
                      <td>If model run is being created by an external user.</td>
                      <td>UUID</td>
                      <td>F</td>
                  </tr>
              </tbody>


          </table>

                            <h5>Example JSON:</h5>
 <pre>{"description":"Isnobal run with high temeratures at night", "model_run_name":"ISNOBAL-AQ2-A93", "model_keywords":"isnobal, high temps, night", "externaluserid":"3ebde0ea-3ccc-11e7-afca-1379018a5da5"}</pre>

                            <h5>Example Python:</h5>
<pre>

#!/usr/bin/python
import json
import requests

import urllib3
urllib3.disable_warnings()

hostname = "vwp-dev.unm.edu"
u = "username"
p = "password"
with requests.session() as s:

    login_url = "https://" + hostname + "/apilogin"
    l= s.get(login_url, auth=(u,p), verify=False)
    print l.text
    if l.status_code == 200:
        data = {"description":"Isnobal run with high temperatures at night", "model_run_name":"ISNOBAL-AQ2-A93", "model_keywords":"isnobal, high temps, night","externaluserid":"3ebde0ea-3ccc-11e7-afca-1379018a5da5"}
        model_id_url = "https://" + hostname + "/apps/vwp/newmodelrun"
        result = s.post(model_id_url, data=json.dumps(data), auth=(u, p), verify=False)
        if result.status_code == 200:
            sessionid = s.cookies.get('SESSIONID')
            model_run_uuid = result.text
            print model_run_uuid
        else:
            print "Failure to insert!"
	    print "Error is: " + result.txt
    else:
        print "Login failure"
        print l.text


</pre>
                            <h4>Response</h4>
                            <p>modelrun UUID</p>
                        </div>
                    </li>


                      <li id="checkmodeluuid">
                        <div class="http-definition">
                            <h3>
                                <span class="http-method">POST</span>
                                <span class="http-path">/apps/{app}/checkmodeluuid</span>
                                <span class="http-name">Check if model_run_uuid exists.</span>
                            </h3>
                        </div>

                        <div class="http-options">
                            <p>Verifies if a model run UUID already exists.</p>
                            

                            <h4>Request Parameters</h4>
                            <h5>Route Parameters</h5>
                            <p>{app}</p>
                            <h5>Query Parameters</h5>
                            <p>modelid:</p>
                            <h5>Examples:</h5>
                            <pre>{"modelid": "1dacc407-6488-42c1-a4de-0b6de97b46c1"}</pre>
                            <h4>Response</h4>
                            <p>True or False</p>
                        </div>
                    </li>

                    <li id="statistics">
                        <div class="http-definition">
                            <h3>
                                <span class="http-method">GET</span>
                                <span class="http-path">/apps/{app}/datasets/{uuid}/statistics.{ext}</span>
                                <span class="http-name">Get dataset statistics</span>
                            </h3>
                        </div>

                        <div class="http-options">
                            <p>Get basic statistics for a dataset. This includes descriptive statistics such as mean, minimum and maximum for 
                            numeric fields for tabular of vector data or histograms for raster data.</p>
                            

                            <h4>Request Parameters</h4>
                            <h5>Route Parameters</h5>
                            <p>Coming soon.</p>

                            <h5>Query Parameters</h5>
                            <p>Coming soon.</p>

                            <h5>Examples</h5>
                            <p>Coming soon.</p>

                            <h4>Response</h4>
                            <p>Coming soon.</p>
                        </div>
                    </li>

                     <li id="delete">
                        <div class="http-definition">
                            <h3>
                                <span class="http-method">POST</span>
                                <span class="http-path">/apps/{app}/deletemodelid</span>
                                <span class="http-name">Delete model run id and all associated datasets</span>
                            </h3>
                        </div>

                        <div class="http-options">
                            <p>Deletes a given model run uuid value, as well as all of the associated dataset records.</p>
                            <p>The function chests for the existence of the given model uuid parameter in the database, and if present, checks whether the model run id has children model runs and datasets. If a model run uuid is not found, execution returns an error. If the model run id has children model runs and datasets, execution halts and an error is returned.</p>


                            <h4>Request Parameters</h4>
                            <h5>Route Parameters</h5>
                              <table class="params">
                                <thead>
                                    <tr>
                                        <th>Parameter</th>
                                        <th>Description</th>
                                        <th>Type</th>
                                        <th>Options</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr>
                                        <td>app</td>
                                        <td>Application alias</td>
                                        <td>string</td>
                                        <td>rgis, epscor, elseweb, vwp</td>
                                    </tr>
                                </tbody>
                            </table>

                            <h5>Query Parameters</h5>
                            
                              <table class="params">
                                <thead>
                                    <tr>
                                        <th>Parameter</th>
                                        <th>Description</th>
                                        <th>Type</th>
                                        <th>Options</th>
                                        <th>Required</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr>
                                        <td>model_uuid</td>
                                        <td>Model run uuid value</td>
                                        <td>uuid</td>
                                        <td></td>
                                        <td>T (no defaults)</td>
                                    </tr>
                                </tbody>
                            </table>

                            <h5>Code Example</h5>
<pre>import os
import json
import requests

import urllib3
urllib3.disable_warnings()

hostname = "vwp-dev.unm.edu"
u = "username"
p = "password"
with requests.session() as s:
    login_url = "https://" + hostname + "/apilogin"
    l= s.get(login_url, auth=(u,p), verify=False)
    print l.text
    if l.status_code == 200:
        data = {"model_uuid":"240a2330-9c13-40f3-625d-f96939cf3ae6"}
        model_id_url = "https://" + hostname + "/apps/vwp/deletemodelid"
        result = s.delete(model_id_url, data=json.dumps(data), auth=(u, p), verify=False)
        sessionid = s.cookies.get('SESSIONID')
        model_run_uuid = result.text
        print model_run_uuid
    else:
        print "Login failure"
        print l.text
</pre>

                            <h4>Response</h4>
                            <p>Coming soon.</p>
                        </div>
                    </li>


                </ul>
            </div>
        </div>
    </div>
    

    
    </div>
    <footer >
        <div class="container">
            <div class="col-sm-6">
                <p><a href="http://edac.unm.edu">Earth Data Analysis Center</a> &#169; 2014</p>
                <p><a href="mailto:wcwave@edac.unm.edu">wcwave[at]edac.unm.edu</a></p>
                <p><a href="../tos.html">Terms of Service</a></p>
            </div>
            <div class="col-sm-6">
                <!-- <img src="../images/EDAC-Banner1_2.png"> -->
            </div>
            
        </div>
    </footer>

</body>
</html>
