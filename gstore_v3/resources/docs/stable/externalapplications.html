<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html>
<head>
    <title>Virtual Watershed API | Developer - Applications</title>
    <link href="../bootstrap/css/bootstrap.min.css" rel="stylesheet" media="screen">
    <link href="../docs.css" rel="stylesheet" media="screen">

</head>
<body>
    <div id="wrap">
<div class="navbar navbar-inverse" role="navigation">
        <div class="container">
            <div class="navbar-header">
                <a class="navbar-brand" href="../index.html">Virtual Watershed</a>
            </div>
            <div class="collapse navbar-collapse">
                <ul class="nav navbar-nav">
                    <li class="active"><a href="../stable.html">Stable</a></li>
                    <li><a href="../../developer/">Developer</a></li>
                    <li><a href="../architecture.html">Architecture</a></li>
                </ul>
            </div>
        </div>
    </div>

    <div class="container docs">
        <div class="row" >

            <h1>External Applications</h1>
               External appliations allows you to associate an internal account with an external application, and insert datasets that are then associated with external users.
            <p>This is a one to one relationship. Each account can only be associated with a single external application.
              <br>You must associate the account with an app before creating external users with that account.</p>
            <p></p>
        </div>

        <div class="row">
            <div class="col-lg-12 col-no-padding">
                <ul>
                    <li id="tieaccount">
                        <div class="http-definition">
                            <h3>
                                <span class="http-method">POST</span>
                                <span class="http-path">/createexternalapp</span>
                                <span class="http-name">Tie existing internal VWP account to new external application.</span>
                            </h3>
                        </div>

                        <div class="http-options">
                            <p></p>


                            <h4>Request Payload</h4>
                            <pre>

    {'application':'virtualwatershed.org'}
                            </pre>



                            <h4>Example post using Python</h4>
                            <pre>

#!/usr/bin/python

import json
import requests
#PAYLOAD
payload = {'application':'virtualwatershed.org'}

#URLS
LOGIN_URL = 'https://vwp-dev.unm.edu/apilogin'
TIE_ACCOUNT_TO_USER_URL = 'https://vwp-dev.unm.edu/createexternalapp'

#LOGIN
s = requests.Session()
s.auth = ('vwadmin@edac.unm.edu', 'notarealpassword')
s.verify = False
l = s.get(LOGIN_URL)

#POST THE PAYLOAD
result = s.post(TIE_ACCOUNT_TO_USER_URL, data=json.dumps(payload))
if result.status_code != 200:
   print '\t', result.content
else:
   print result.content

                            </pre>
                            <h4>Expected response</h4>
                            <h5></h5>
                            <pre>

vwadmin@edac.unm.edu now tied to virtualwatershed.org
                            </pre>
                        </div>

                    </li>

                </ul>
            </div>



<div class="http-definition" id="createexternaluser">
                            <h3>
                                <span class="http-method">POST</span>
                                <span class="http-path">/createexternaluser</span>
                                <span class="http-name">Create external user for the external app <strong>the posting user</strong> is tied to.</span>
                            </h3>
</div>





<div class="http-options">

  <p></p>


  <h4>Request Payload</h4>
  <pre>

{'userid': '3ebde0ea-3ccc-11e7-afca-1379018a5da1'}
  </pre>



  <h4>Example post using Python</h4>
  <pre>

    #!/usr/bin/python

    import json
    import requests
    #PAYLOAD

    payload = {'userid': '3ebde0ea-3ccc-11e7-afca-1379018a5da1'}

    #URLS
    LOGIN_URL = 'https://vwp-dev.unm.edu/apilogin'
    CREATE_EXTERNAL_USER_URL = 'https://vwp-dev.unm.edu/createexternaluser'

    #LOGIN
    s = requests.Session()
    s.auth = ('vwadmin@edac.unm.edu', 'notarealpassword')
    s.verify = False
    l = s.get(LOGIN_URL)

    #POST THE PAYLOAD
    result = s.post(CREATE_EXTERNAL_USER_URL, data=json.dumps(payload))
    if result.status_code != 200:
       print '\t', result.content
    else:
       print result.content
  </pre>
                            <p></p>
                            <h4>Expected response</h4>
                            <h5></h5>
                            <pre>

User ID created: 3ebde0ea-3ccc-11e7-afca-1379018a5da1
                            </pre>






        </div><p></p>
        <div class="http-definition" id="showexternalusers">

                                    <h3>
                                        <span class="http-method">GET</span>
                                        <span class="http-path">/showexternalusers</span>
                                        <span class="http-name">Show a list of users <strong>the logged in user</strong> is associated with.</span>
                                    </h3>
        </div>
        <div class="http-options">
          <p></p>
          <h4>Example response</h4>
          <pre>
            {

                "app": "virtualwatershed.org",
                "userids": [
                    "3ebde0ea-3ccc-11e7-afca-1379018a5da5",
                    "e8b587a4-3cce-11e7-b2a0-577eb1672391",
                    "e12d9bc4-3ccf-11e7-b95a-0337d5e67008"
                ]

            }
          </pre>
          <p></p>
          <h5>Query Parameters</h5>
          <table class="params">
              <thead>
                  <tr>
                      <th>Parameter</th>
                      <th>Description</th>
                      <th>Type</th>
                      <th>Options</th>
                      <th>Required</th>
                  </tr>
              </thead>
              <tbody>
                  <tr>
                      <td>userid</td>
                      <td>Returns True if user exists or False if user does not exist.</td>
                      <td>UUID</td>
                      <td></td>
                      <td>F</td>
                  </tr>
              </tbody>
          </table>
       </div>

       <p></p>
       <div class="http-definition" id="search">

                                   <h3>
                                       <span class="http-method">POST</span>
                                       <span class="http-path">/apps/{app}/datasets</span>
                                       <span class="http-name">Relevant system metadata parameters</span>
                                   </h3>
       </div>
       <div class="http-options">
         <p></p>
         <pre>

<samp  style="color: grey;">
           {
             ...
               "formats": ["zip"],
               "description": "Incline_Creek_WatershedBnds_Soilmu",</samp>
               <strong>"externaluserid": "91496f1b-b727-4d10-a475-fdb0d0b09e3f",</strong><samp  style="color: grey;">
               "parent_model_run_uuid": "8ad6769d-b0af-4a75-87ad-cacdc77f9d61",
               "apps": ["vwp"]
            ...
           }</samp>
         </pre>
         For more info on inserting data see <a href="datasets.html#datasetupload">Upload Dataset Information</a>
      </div>
      <p></p>
      <div class="http-definition">


                                  <h3>
                                      <span class="http-method">GET</span>
                                      <span class="http-path">/apps/{app}/search/{datatype}.{ext}</span>
                                      <span class="http-name">Relevant search parameters</span>
                                  </h3>
      </div>
      <div class="http-options">
        <p></p>
        <h5>Query Parameters</h5>
        <table class="params">
            <thead>
                <tr>
                    <th>Parameter</th>
                    <th>Description</th>
                    <th>Type</th>
                    <th>Options</th>
                    <th>Required</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td>externalapp</td>
                    <td>limit search to only the datasets that are assoiated with external app.</td>
                    <td>string</td>
                    <td></td>
                    <td>F</td>
                </tr>
                <tr>
                    <td>externaluserid</td>
                    <td>limit search to only the datasets that are assoiated with external userid.</td>
                    <td>UUID</td>
                    <td></td>
                    <td>F</td>
                </tr>
            </tbody>
        </table>
        For more info on searching see <a href="search.html#search-objects">Search</a>
     </div>

    </div>




    </div>
    <footer >
        <div class="container">
            <div class="col-sm-6">
                <p><a href="http://edac.unm.edu">Earth Data Analysis Center</a> &#169; 2014</p>
                <p><a href="mailto:wcwave@edac.unm.edu">wcwave[at]edac.unm.edu</a></p>
                <p><a href="../tos.html">Terms of Service</a></p>
            </div>
            <div class="col-sm-6">
                <!-- <img src="../images/EDAC-Banner1_2.png"> -->
            </div>

        </div>
    </footer>

</body>
</html>
